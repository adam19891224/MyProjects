function Applications(){var _this=this;var EMAIL_REG=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;var SITE_REG=/[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?/;var NUM_REG=/^\+?[1-9][0-9]*$/;this.castStr2Num=function(str){return parseInt(str)};this.isNotNull=function(str){if(Object.prototype.toString.call(str)==="[object String]"){return(str!=null&&str!=""&&str!=undefined)}return(str!=null&&str!=""&&str!=undefined&&str.length>0)};this.replaceBlock=function(str){return str.replace(/\s/g,'')};this.checkIsEmail=function(str){return EMAIL_REG.test(str)};this.checkIsSite=function(str){return SITE_REG.test(str)};this.checkIsNum=function(str){return NUM_REG.test(str)}}var applications=new Applications();Date.prototype.Format=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S":this.getMilliseconds()};if(/(y+)/.test(fmt))fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length));for(var k in o)if(new RegExp("("+k+")").test(fmt))fmt=fmt.replace(RegExp.$1,(RegExp.$1.length==1)?(o[k]):(("00"+o[k]).substr((""+o[k]).length)));return fmt};$(function(){$("#search-button").click(function(){var input=$(this).prev();var locations="/eyes/";var val=input.val();if(applications.isNotNull(val)&&!val.match(/^\s+$/)){val=input.val().replace(/(^\s*)|(\s*$)/g,"").replace(/\\/g,"").replace(/\//g,"");locations="/query/"+val+"/1"}$.pjax({url:locations,container:'#main'})});$(document).pjax('.link-head','#main',{maxCacheLength:0,cache:true,storage:true,timeout:10000});$(document).bind('pjax:send',function(){$("#loading-page-bar").animate({width:"70%"},1000)});$(document).bind('pjax:success',function(){$("#loading-page-bar").animate({width:"100%"},300,function(){$("#loading-page-bar").width("0")});var href=window.location.href;if(href.indexOf("eyes")>0){var eyes=new Eyes();eyes.init()}if(href.indexOf("index")>0){var index=new Index();index.init()}if(href.indexOf("query")>0){var search=new Searchs();search.init()}if(href.indexOf("genre")>0){var category=new Category();category.init()}if(href.indexOf("blogs")>0){var blogs=new Blogs();blogs.init()}startCloud()});$("#header-nav-ul li a").click(function(){$(this).parent().addClass("header-underline").siblings().removeClass("header-underline")});startCloud()});function startCloud(){var categorys=new CategoryUtils();var typeObj=$("#type-body");if(typeObj.length>0){categorys.init(typeObj)}}function Index(){var isClick=true;this.init=function(){this.initPage();this.pageClickListener()};this.initPage=function(){new Blazy({container:'.blog-body',error:function(ele,msg){ele.src="/base/images/failed.png"}})};this.pageClickListener=function(){$("#page-div").createPage({pageCount:applications.castStr2Num($("#page-div").attr("data-pages")),current:applications.castStr2Num($("#page-div").attr("data-current")),backFn:function(page){if(isClick){var location="/index/";if(page>1){if(applications.checkIsNum(page)){location="/index/"+page}}$.pjax({url:location,container:'#main'})}}})}}function Eyes(){var timeDiv=$("#time-div");var blogDiv=$("#container-title");var scrollLeft=$("#container-title").offset().left;this.init=function(){this.scrollBarListener();this.timeYearClickListener();this.timeMonthClickListener()};this.scrollBarListener=function(){var windowHeight;var _window=$(window);var firstDiv,nowY,nowM;var isLis=false;_window.scroll(function(){windowHeight=_window.scrollTop();if(windowHeight>100){timeDiv.css("position","fixed");isLis=true;autoChangeTimeBar()}else{if(isLis){isLis=false;timeDiv.css("position","relative");firstDiv=timeDiv.find(".time-year").first();var tempY=timeDiv.attr("n-y");var tempM=timeDiv.attr("n-m");nowY=firstDiv.find("em").text();nowM=firstDiv.find("li:first").attr("t-m");if(tempY==nowY&&tempM==nowM){return}timeDiv.find("em").removeClass("now-year").end().find("i").removeClass("yead-front-up").end().find("li").removeClass("now-month");firstDiv.find("em").addClass("now-year").end().find("i").addClass("yead-front-up").end().find("li:first").addClass("now-month");timeDiv.attr("n-y",nowY).attr("n-m",nowM);if(firstDiv.find("ul").css("display")=="none"){timeDiv.find("ul").slideUp(200);firstDiv.find("ul").slideDown(200)}}}})};this.timeYearClickListener=function(){var _this,nowY,thisY,thisM;timeDiv.on("click","span",function(){_this=$(this);thisY=_this.attr("class");nowY=timeDiv.attr("n-y");if(thisY!=nowY){thisM=_this.parent().find("li:first").attr("t-m");gotoScrollBlogLine(thisY,thisM)}})};this.timeMonthClickListener=function(){var _this,nowY,nowM,thisY,thisM;timeDiv.on("click","li",function(){_this=$(this);thisY=_this.parents(".time-year").find("em").text();thisM=_this.attr("t-m");nowY=timeDiv.attr("n-y");nowM=timeDiv.attr("n-m");if(nowY==thisY&&nowM!=thisM){gotoScrollBlogLine(thisY,thisM)}})};var changeTimeBar=function(tarY,tarM){var bar_year=timeDiv.attr("n-y");var bar_month=timeDiv.attr("n-m");if(tarY!=bar_year){timeDiv.attr("n-y",tarY).find("i").removeClass("yead-front-up").end().find("em").removeClass("now-year").end().find("ul").slideUp(200);$("."+tarY).find("i").addClass("yead-front-up").end().find("em").addClass("now-year").end().parent().find("ul").slideDown(200);timeDiv.attr("n-m",tarM).find("li").removeClass().end().find("."+tarY).parent().find("li[t-m='"+tarM+"']").addClass("now-month")}else if(tarM!=bar_month){timeDiv.attr("n-m",tarM).find("li").removeClass().end().find("."+tarY).parent().find("li[t-m='"+tarM+"']").addClass("now-month")}};var autoChangeTimeBar=function(){var year,month;window.onresize=function(){scrollLeft=$("#container-title").offset().left};var nowDom=document.elementFromPoint(scrollLeft,0);nowDom=$(nowDom);var tarName=nowDom.prop("tagName");if(tarName=="H2"){var bar_year=timeDiv.attr("n-y");var bar_month=timeDiv.attr("n-m");year=nowDom.attr("data-year");month=nowDom.attr("data-month");if(bar_year!=year||bar_month!=month){changeTimeBar(year,month)}}};var gotoScrollBlogLine=function(tarY,tarM){var tarF=blogDiv.find("h2[data-year='"+tarY+"'][data-month='"+tarM+"']:first");doScrollByHeight(tarF.offset().top)};var doScrollByHeight=function(height){$("body, html").animate({scrollTop:height},600)}}function Searchs(){var isClick=true;this.init=function(){this.pageBarLister();$("#header-nav-ul li").eq(2).addClass("header-underline").siblings().removeClass("header-underline")};this.pageBarLister=function(){$("#page-div").createPage({pageCount:applications.castStr2Num($("#page-div").attr("data-pages")),current:applications.castStr2Num($("#page-div").attr("data-current")),backFn:function(page){if(isClick){isClick=false;var location=window.location.href;if(page>0){if(applications.checkIsNum(page)){location=location.substr(0,location.lastIndexOf("/")+1);location+=page}}$.pjax({url:location,container:'#main'})}}})}}function Category(){var isClick=true;this.init=function(){this.imgLazyload();this.pageBarListener();$("#header-nav-ul li").eq(2).addClass("header-underline").siblings().removeClass("header-underline")};this.imgLazyload=function(){new Blazy({container:'.cate-info-container',error:function(ele,msg){ele.src="/base/images/failed.png"}})};this.pageBarListener=function(){$("#page-div").createPage({pageCount:applications.castStr2Num($("#page-div").attr("data-pages")),current:applications.castStr2Num($("#page-div").attr("data-current")),backFn:function(page){if(isClick){isClick=false;var location=window.location.href;if(page>0){if(applications.checkIsNum(page)){location=location.substr(0,location.lastIndexOf("/")+1);location+=page}}$.pjax({url:location,container:'#main'})}}})}}function Blogs(){var replyEidtorDiv="<div id=\"reply-editor-div\" class=\"reply-editor\"><textarea id=\"reply-main-editor\" cols=\"1\" rows=\"1\" class='reply-main-editor' title=\"回复\"></textarea></div>";var replyButtonDiv="<div id=\"reply-buttons-div\" class=\"reply-buttons\"><span id=\"reply-error-msg\" class=\"error-message\"></span><a id='submit-reply-button' class=\"submit-reply-button\">回复</a></div>";var commentEditor,replyEditor;var isLoadingComment=false;this.init=function(){this.initPage();this.commentReplyButtonClick();this.commentShowButtonClick();this.commentSubmitButtonClick();this.replySubmitButtonClick();this.dataSubmitClick();this.dataCancleClick();this.websiteClick();Prism.highlightAll();$("#header-nav-ul li").eq(3).addClass("header-underline").siblings().removeClass("header-underline")};this.initPage=function(){commentEditor=CKEDITOR.instances["comment-main-editor"];if(commentEditor){commentEditor.destroy()}commentEditor=CKEDITOR.replace("comment-main-editor",{height:"160px"});loadingComment(1,true)};this.commentReplyButtonClick=function(){var _this,_thisL;$("#articlt-comment-div").on("click",".to-reply",function(){_this=$(this);var l=_this.attr("data-l");if(l=="0"){_this.attr("data-l","1");_thisL=_this.parents("li");if(_thisL.find("#reply-editor-div").length==0&&_thisL.find("#reply-buttons-div").length==0){$("#reply-editor-div").remove();$("#reply-buttons-div").remove();$(".reply-color").removeClass("reply-color");_this.addClass("reply-color");_thisL.find(".main-reply-container").append(replyEidtorDiv).append(replyButtonDiv);replyEditor=CKEDITOR.replace("reply-main-editor",{height:"100px"})}_this.attr("data-l","0")}})};this.commentShowButtonClick=function(){var _this,_thisL;$("#articlt-comment-div").on("click",".to-show",function(){_this=$(this);_thisL=_this.parents("li");var l=_this.attr("data-l");if(l=="0"){_this.attr("data-l","1");var type=_this.data("type");if(type!="y"){loadingReplyCommentsByDiv(_thisL,_this)}else{if(_this.hasClass("show-color")){_this.removeClass("show-color").text("展开");_thisL.find(".reply-container").fadeOut("fast")}else{_this.addClass("show-color").text("收起");_thisL.find(".reply-container").fadeIn("fast")}_this.attr("data-l","0")}}})};this.commentSubmitButtonClick=function(){var _this;$("#comment-submit").click(function(){_this=$(this);var lock=_this.data("lock");if(lock!="1"){_this.data("lock","1");$("#comment-error-msg").text("");var content=commentEditor.document.getBody().getText();var data=commentEditor.getData();content=applications.replaceBlock(content);if(!applications.isNotNull(data)||!applications.isNotNull(content)){alert("评论内容不能为空!");$("#comment-error-msg").text("评论内容不能为空!")}else{$("#whole-div").data("comment",data);$("#whole-div").data("isReply",0);$("#whole-div").data("replyUser","");$("#whole-div").data("replyBody","");$("#whole-div").show()}_this.data("lock","0")}})};this.replySubmitButtonClick=function(){var _this;$("#articlt-comment-div").on("click","#submit-reply-button",function(){_this=$(this);var lock=_this.data("lock");if(lock!="1"){_this.data("lock","1");$("#reply-error-msg").text("");var content=replyEditor.document.getBody().getText();var data=replyEditor.getData();content=applications.replaceBlock(content);if(!applications.isNotNull(data)||!applications.isNotNull(content)){alert("回复内容不能为空!");$("#reply-error-msg").text("回复内容不能为空!")}else{$("#whole-div").data("comment",data);$("#whole-div").data("isReply",1);var _thisP=_this.parents("li");$("#whole-div").data("replyUser",_thisP.find(".mian-name").find("span").first().text());$("#whole-div").data("replyBody",_thisP.attr("data-id"));$("#whole-div").show()}_this.data("lock","0")}})};this.dataSubmitClick=function(){$("#to-submit").click(function(){var name=$("#friend-name").val();var email=$("#friend-email").val();var type=$("#friend-sitetype").val();var site=$("#friend-website").val();if(!applications.isNotNull(name)){alert("请大牛输入昵称");return false}if(!applications.isNotNull(email)){alert("请大牛输入邮箱");return false}var obj={};var isReply=$("#whole-div").data("isReply");var dataId=$("#whole-div").data("replyBody");obj.commentUser=name;if(!applications.checkIsEmail(email)){alert("请大牛输入正确的邮箱地址");return false}obj.commentEmail=email;if(applications.isNotNull(site)&&!applications.checkIsSite(site)){alert("请大牛输入正确的网站地址");return false}site=site.replace("http://","");site=site.replace("https://","");if(type=="http"){site="http://"+site}else if(type=="https"){site="https://"+site}obj.commentUserWebsite=site;$("#whole-div").hide();$("#loading-div").show();obj.articleId=$("#article-body").attr("data-aid");obj.commentBody=$("#whole-div").data("comment");obj.commentIsReply=isReply;obj.commentReplyUser=$("#whole-div").data("replyUser");obj.commentReplyBody=dataId;obj.ck=$("#articlt-comment-div").attr("ck");$.post('/blogs/postComment.html',obj,function(text){if(text!="success"){if(text=="error"){alert("提交评论失败")}else{alert("拒绝访问")}}$.pjax({url:location,container:'#main'})})})};this.dataCancleClick=function(){$("#to-cancle").click(function(){$("#whole-div").data("comment","").hide()})};this.websiteClick=function(){var site="";$("#articlt-comment-div").on("click",".has-website",function(){site=$(this).attr("data-w");if(site.indexOf("http://")>=0||site.indexOf("https://")>=0){window.open(site)}else{window.open("http://"+site)}})};var loadingReplyCommentsByDiv=function(li,span){var lineDiv=li.find(".main-line");lineDiv.animate({width:"60%"},500,function(){lineDiv.animate({width:"70%"},1000,function(){var obj={};obj.articleId=$("#article-body").attr("data-aid");obj.commentId=li.attr("data-id");obj.commentIsReply=1;obj.pagination=false;$.post("/blogs/getComment.html",obj,function(res){var result=eval("("+res+")");var isOk=result.isOk;var lis="";if(isOk=="Y"){var list=result.list;lis=getReplysLis(list)}else{lis="<li class='reply-no-datas'>没有回复数据</li>"}lineDiv.animate({width:"100%"},function(){li.find(".reply-container").empty().append(lis).fadeIn("fast");span.data("type","y").addClass("show-color").text("收起");lineDiv.css("width","0");span.attr("data-l","0")})})})})};var loadingComment=function(page,init){$("#articlt-comment-div").find(".comment-container").empty().append("<li class=\"comment-loading\"><i class=\"loading-bar\"></i></li>");var obj={};obj.isReply=0;obj.articleId=$("#article-body").attr("data-aid");obj.commentIsReply=0;obj.page=page;$.ajax({url:"/blogs/getComment.html",data:obj,type:"post",timeout:5000,complete:function(XHR,TextStatus){if(TextStatus=='timeout'){$("#articlt-comment-div").find(".comment-container").empty().append("<li class=\"comment-no-data\"><span>超时了。。。</span></li>");isLoadingComment=false}},success:function(text){var result=eval("("+text+")");var isOk=result.isOk;var lis="";if(isOk=="Y"){var pages=result.totalPages;var current=result.current;var list=result.list;lis=getCommentLis(list);if(init&&current<pages){createPageLine(pages,current)}}else{lis="<li class=\"comment-no-data\"><span>暂无评论~~~~(>_<)~~~~</span></li>"}$("#articlt-comment-div").find(".comment-container").empty().append(lis);isLoadingComment=false}})};var getCommentLis=function(list){var tempO,lis="",time="",span="";for(var a=0,b=list.length;a<b;a++){tempO=list[a];time=new Date(tempO.createDate).Format("yyyy-MM-dd");var site=tempO.commentUserWebsite;if(applications.isNotNull(site)&&applications.checkIsSite(site)){span="<span class='has-website' data-w='"+site+"'>"+tempO.commentUser+"：</span><span>"+time+"</span>"}else{span="<span>"+tempO.commentUser+"：</span><span>"+time+"</span>"}lis+="<li data-id='"+tempO.commentId+"'>"+"<div class='comment-left'>"+"<div class='left-head'></div>"+"</div>"+"<div class='comment-right'>"+"<div class='right-main'>"+"<div class='mian-name'>"+span+"</div>"+"<div class='main-content'>"+tempO.commentBody+"</div>"+"<div class='main-reply'>"+"<span class='to-reply' data-l='0'>回复</span><span class='to-show' data-l='0'>展开</span>"+"</div>"+"<div class='main-line'></div>"+"<div class='main-reply-container'>"+"<ul class='reply-container' load='0'>"+"</ul>"+"</div>"+"</div>"+"</div>"+"</li>"}return lis};var createPageLine=function(count,current){$("#comment-pages").empty();$("#comment-pages").createPage({pageCount:count,current:current,backFn:function(page,eve,obj){if(!isLoadingComment){isLoadingComment=true;eve.fillHtml(obj,{"current":page,"pageCount":count});loadingComment(page,false)}}})};var getReplysLis=function(list){var lis="",time="";var tempO;for(var a=0,b=list.length;a<b;a++){tempO=list[a];time=new Date(tempO.createDate).Format("yyyy-MM-dd");var site=tempO.commentUserWebsite;if(applications.isNotNull(site)&&applications.checkIsSite(site)){span="<span class='has-website' data-w='"+site+"'>"+tempO.commentUser+"：</span><span>"+time+"</span>"}else{span="<span>"+tempO.commentUser+"：</span><span>"+time+"</span>"}lis+="<li>"+"<h5>"+span+"</h5>"+"<div class=\"reply-content\">"+tempO.commentBody+"</div>"+"</li>"}return lis}}