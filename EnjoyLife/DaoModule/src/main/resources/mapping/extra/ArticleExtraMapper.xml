<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.article.dao.ArticleMapper" >

    <resultMap id="NewArticleBody" type="com.article.vo.NewArticle" extends="ResultMapWithBLOBs" >
        <result column="hots" property="hots" jdbcType="INTEGER" />
    </resultMap>

    <select id="selectByPage" resultMap="NewArticleBody" parameterType="com.foundation.view.Page">
        SELECT
          ta.*
        FROM
          tb_article ta
        <where>
            <if test="kw != null and kw != '' ">
                ta.ARTICLE_TITLE LIKE CONCAT('%', #{kw}, '%')
            </if>
        </where>
        ORDER BY ta.CREATE_DATE DESC
        limit #{pageNum}, #{pageSize}
    </select>

    <select id="selectCountsByPage" resultType="java.lang.Integer" parameterType="com.foundation.view.Page">
        SELECT
          COUNT(1)
        FROM
          tb_article ta
        <where>
            <if test="kw != null and kw != '' ">
                ta.ARTICLE_TITLE LIKE CONCAT('%', #{kw}, '%')
            </if>
        </where>
    </select>

    <select id="selectHotsLimitEight" resultMap="NewArticleBody">
        SELECT
            temp.*
        FROM
            (SELECT
                ta.ARTICLE_SID,
                ta.ARTICLE_TITLE,
                (
                    SELECT
                        COUNT(tac.ARTICLE_COMMENT_ID)
                    FROM
                        tb_article_comment tac
                    INNER JOIN tb_comment tc ON tac.COMMENT_ID = tc.COMMENT_ID
                    WHERE
                        tac.ARTICLE_ID = ta.ARTICLE_ID
                    AND tc.COMMENT_IS_REPLY = 0
                ) hots
            FROM
                tb_article ta
            ORDER BY hots DESC
            ) temp
        WHERE
          temp.hots > 0
        LIMIT 0,8
    </select>


    <resultMap id="ArticleTimeForYear" type="com.article.vo.ArticleTime" >
        <result column="article_year" property="date" jdbcType="VARCHAR" />
        <collection property="list" column="article_year" select="selectTimeByYear"/>
    </resultMap>

    <select id="selectTimeGroupByArticle" resultMap="ArticleTimeForYear">
        SELECT
            DATE_FORMAT(CREATE_DATE, "%Y") article_year
        FROM
            tb_article
        GROUP BY
            article_year
        ORDER BY
            article_year DESC
    </select>

    <resultMap id="ArticleTimeForMonth" type="com.article.vo.ArticleTime" >
        <result column="article_month" property="date" jdbcType="VARCHAR" />
    </resultMap>

    <select id="selectTimeByYear" resultMap="ArticleTimeForMonth">
        SELECT
            DATE_FORMAT(CREATE_DATE, "%m") article_month
        FROM
            tb_article
        WHERE
             date_format(CREATE_DATE, '%Y') = #{date}
        GROUP BY
            article_month
        ORDER BY
            article_month DESC
    </select>

</mapper>